---
title: "image rotation all"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(EBImage)
library(tidyverse)
train_dir <- "../data/train_set/" # This will be modified for different data sets.
train_image_dir <- paste(train_dir, "images/", sep="")
train_pt_dir <- paste(train_dir,  "points/", sep="")
train_label_path <- paste(train_dir, "label.csv", sep="") 
load("../output/fiducial_pt_list.RData")
```


```{r}
single = c(35,36,37,38,44,52,56,59,62)
double = data.frame(x1 = c(1,2,3,4,5,6,7,8,9,19,20,21,22,23,24,25,26,39,40,41,42,43,50,51,57,58,63),
                    x2 = c(10,15,14,13,12,11,18,17,16,31,30,29,28,27,34,33,32,49,48,47,46,45,54,53,55,60,61))
```

```{r}
source("../xjx_lib/change_images.R")
```

```{r}
indices = 27:29
result_move = change_image(indices)
new_points = map(result_move, ~.x[[1]])
new_img = map(result_move, ~.x[[2]])
```

```{r}
display(new_img[[2]], method = 'raster')
points(new_points[[2]]$x, new_points[[2]]$y, col = 'blue', cex = 1, pch = 16)
points(500,375, cex = 3, pch = 16, col = 'red')
points(500,750, cex = 3, pch = 16, col = 'red')
```

```{r}
begin = Sys.time()
indices = 1:25
result_move = change_image(indices)
new_points = map(result_move, ~.x[[1]])
new_img = map(result_move, ~.x[[2]])
end = Sys.time()
```

```{r}
(end-begin)*100
```

```{r}
all_points = NULL
for(i in 1:2){
  indices = 1:25 + (i-1)*25
  result_move = change_image(indices)
  new_points = map(result_move, ~.x[[1]])
  new_img = map(result_move, ~.x[[2]])
  all_points = c(all_points, new_points)
  
}
```

```{r}
begin2 = Sys.time()
indices = 1:25
new_points = change_points(indices)
end2 = Sys.time()
```

```{r}
(end2-begin2)*100
```

```{r}
begin3 = Sys.time()
indices = 1:2500
all_points = change_points(indices)
end3 = Sys.time()
all_points = map(all_points, as.matrix)
```

```{r}
end3-begin3
```

```{r}
save(all_points, file="../output/all_points.RData")
```




