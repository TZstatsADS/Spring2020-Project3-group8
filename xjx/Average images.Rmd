---
title: "Average Images"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r , include=FALSE}
library(tidyverse)
library(ggplot2)
library(EBImage)
source("../xjx_lib/change_images.R")
info <- read.csv("../data/train_set/label.csv")
```

```{r, include=FALSE}
img = change_image(1)[[1]][[2]]
display(img, method = 'raster')
```

```{r , include=FALSE}
img1 = img
img1 = 1-(1-img1)/20
display(img1, method = 'raster')
```

```{r , include=FALSE}
draw_ave = function(indices, char)
{
  l = length(indices)
  ave_img = change_image(1)[[1]][[2]][100:900,75:675,] * 0
  for(i in 1:l){
    img = change_image(indices[i])[[1]][[2]][100:900,75:675,]
    ave_img = ave_img + (1-img)/l
  }
  ave_img = 1-ave_img
  display(ave_img, method = 'raster')
  title(char)
}
```

```{r}
map(1:22, ~draw_ave(info$Index[info$emotion_idx==.x], with(info, emotion_cat %>% unique)[.x]))
```









